# AI客服SaaS平台 TODO

## 數據庫與後端
- [x] 設計AI個性化配置表 (aiPersonas)
- [x] 設計知識庫文件表 (knowledgeBases)
- [x] 設計快捷按鈕配置表 (quickButtons)
- [x] 設計對話記錄表 (conversations)
- [x] 開發AI個性化配置API
- [x] 開發知識庫管理API
- [x] 開發快捷按鈕配置API
- [x] 開發AI對話API（整合LLM）

## 付費用戶後台
- [x] 後台儀表板佈局
- [x] AI個性化設定頁面（名稱、頭像、歡迎語）
- [x] 知識庫管理頁面（上傳、列表、刪除）
- [x] 快捷按鈕配置頁面
- [x] 專屬URL顯示與複製功能

## 終端客戶對話頁面
- [x] 動態路由頁面 (/chat/:personaId)
- [x] AI頭像和名稱顯示
- [x] 對話歷史區域
- [x] 問題輸入框
- [x] 快捷功能按鈕區域
- [x] 響應式設計（桌面和移動端）
- [x] 即時對話功能

## 視覺設計
- [x] 確定整體視覺風格
- [x] 設計配色方案
- [x] 響應式佈局優化

## 數據分析功能
- [x] 設計數據分析API（對話統計、熱門問題）
- [x] 開發對話統計圖表組件
- [x] 開發熱門問題列表組件
- [x] 整合到儀表板頁面

## 首頁版面設定功能
- [x] 擴展數據庫結構（佈局模板、背景圖片、個人照片、引導問題）
- [x] 開發版面設定API
- [x] 開發後台版面設定頁面（風格選擇、圖片上傳、引導問題配置）
- [x] 更新終端客戶對話頁面支援多種佈局風格
- [x] 實現簡約ChatGPT風格模板
- [x] 實現專業名片風格模板
- [x] 實現自訂背景風格模板

## 版面設定即時預覽
- [x] 在版面設定頁面加入即時預覽小圖示
- [x] 預覽組件顯示三種佈局風格的效果
- [x] 預覽隨設定變更即時更新

## 預覽優化與功能按鈕擴展
- [x] 優化預覽版面：更緊緻、對話方塊更細、profile pic更小
- [x] 支援多個引導問題同時顯示
- [x] 擴展功能按鈕類型（即時預約、產品展示、個人介紹、公司介紹等）
- [x] 更新終端客戶對話頁面支援新功能按鈕

## 簡化後台版面
- [x] 將快捷按鈕配置整合到版面設定頁面
- [x] 使用標籤頁組織版面設定和快捷按鈕
- [x] 更新導航菜單移除獨立的快捷按鈕頁面

## 版面設定標籤重組
- [x] 將版面設定分為三個頂層標籤：外觀風格、快捷按鈕、對話設定
- [x] 將引導問題移到對話設定標籤內
- [x] 優化各標籤的內容組織

## 自訂域名引導區塊
- [x] 在儀表板或設定頁面加入自訂域名引導區塊
- [x] 設計簡潔易用的UI/UX
- [x] 說明免費/付費用戶的URL選項
- [x] 提供操作步驟引導

## 導航欄調整與儀表板簡化
- [x] 將「自訂專屬網址」加入左側導航欄
- [x] 創建自訂網址設定頁面
- [x] 簡化儀表板版面，移除域名引導區塊

## 訓練智能體功能
- [x] 設計訓練智能體資料庫表 (aiTraining)
- [x] 創建訓練智能體頁面UI
- [x] 實現8大維度評分系統（說話風格、回應方式、溝通態度、銷售風格、專業表現、情緒處理、語言習慣、服務邊界）
- [x] 實現1-5分評分選擇器組件
- [x] 實現快速人設模板功能
- [x] 實現自訂指令輸入區域
- [x] 開發後端API存取訓練設定
- [x] 更新導航欄添加訓練智能體入口

## 開發超能力功能
- [x] 設計超能力設定資料庫表 (superpowers)
- [x] 創建超能力設定頁面UI
- [x] 實現五大超能力類別（超級大腦、時間掌控、預知未來、全球視野、讀心術）
- [x] 實現Toggle開關和詳細設定展開
- [x] 實現超能力等級和成就徽章系統
- [x] 開發後端API存取超能力設定
- [x] 更新導航欄添加超能力入口

## AI設定整合到版面設定
- [x] 將AI設定頁面內容（名稱、頭像、歡迎語、System Prompt）整合到版面設定
- [x] 更新版面設定標籤頁結構（新增AI設定標籤）
- [x] 從導航欄移除AI設定入口
- [x] 清理不再需要的Settings路由

## 網站嵌入Widget功能（擴充功能）
- [x] 創建擴充功能頁面（Extensions.tsx）
- [x] 實現Widget設定卡片（位置、顏色、大小、觸發方式）
- [x] 實現嵌入代碼生成功能
- [x] 實現即時預覽Widget效果
- [x] 添加一鍵複製代碼功能
- [x] 顯示其他渠道（WhatsApp、Email等）的「即將推出」卡片
- [x] 更新導航欄添加擴充功能入口

## 簡化擴充功能頁面
- [x] 移除即將推出的渠道卡片（WhatsApp、Email、Telegram等）
- [x] 專注於Widget功能展示
- [x] 加入Widget功能說明和使用場景
- [x] 加入安裝步驟和使用指南


## 帳戶設定和會員計劃系統
- [x] 設計成本結構和會員計劃定價
- [x] 創建訂閱表(subscriptions)和使用量表(usage_logs)
- [x] 創建帳戶設定頁面UI（個人資料、安全設定）
- [x] 創建會員計劃頁面UI（三個計劃對比、升級按鈕）
- [x] 實現後端API（訂閱管理、使用量追蹤）
- [x] 實現免費計劃限額檢查（每日對話數、知識庫大小）
- [x] 在chat.send中添加限額檢查邏輯
- [x] 更新導航欄添加帳戶設定入口


## 對話頁面UI優化
- [x] 對話輸入框置中（類似ChatGPT風格）
- [x] 快捷按鈕改為圖標模式（更小巧精緻）
- [x] 圖標hover時顯示tooltip說明
- [x] 整體結構更緊湊專業
- [x] 版面設定添加「圖標模式」選項（完整/緊湊/圖標三種模式）
- [x] 減少不必要的空白和間距

## 對話頁面置中和導航連結
- [x] 將對話區域（AI頭像、歡迎語、引導問題、快捷按鈕）垂直置中
- [x] 輸入框置中顯示
- [x] 在後台導航欄上方添加「預覽AI對話」連結
- [x] 連結可直接跳轉到用戶的AI對話頁面


## 對話頁面進一步優化（更緊湊專業）
- [x] 縮小AI頭像尺寸（16px→h-10→h-5）
- [x] 縮小引導問題按鈕（py-2.5→py-1.5，text-sm→text-xs）
- [x] 縮小快捷按鈕尺寸（h-8→h-6，text-xs→text-[11px]）
- [x] 減少元素間距（mb-6→mb-4，space-y-2→space-y-1.5）
- [x] 縮小輸入框高度（h-10→h-8）
- [x] 整體風格更乾淨俀落

## 輸入框垂直置中
- [x] 將輸入框與歡迎區域一起垂直置中顯示


## Manus風格對話頁面重新設計
- [x] 歡迎訊息大標題在上方
- [x] 輸入框置中（類似Manus的大輸入框設計）
- [x] 引導問題縮小為小按鈕/標籤，放在輸入框下方
- [x] 快捷按鈕放在引導問題下方
- [x] 版面設定已有歡迎語設定選項


## 團隊/公司計劃功能
- [x] 設計團隊計劃架構（團隊大腦、管理員、成員）
- [x] 創建團隊表（teams）- 團隊基本資料
- [x] 創建團隊成員表（team_members）- 成員角色和權限
- [x] 創建團隊知識庫表（team_knowledge）- 團隊大腦內容
- [x] 更新會員計劃頁面添加團隊計劃選項
- [x] 創建團隊管理頁面UI（團隊資料、成員管理、知識庫）
- [x] 實現團隊管理後端API
- [x] 實現成員知識分享權限控制
- [x] 更新導航欄添加團隊管理入口


## 定價調整優化
- [x] Premium計劃價格從HK$299調整為HK$399
- [x] 企業版成員上限從無限調整為50人
- [x] 更新前端定價頁面顯示
- [x] 更新後端限額檢查邏輯


## 知識庫上傳方式擴展
- [x] 研究可行的知識來源類型
- [x] 設計多來源知識庫架構
- [x] 實現YouTube影片字幕提取
- [x] 實現網頁內容抓取
- [x] 實現直接文字輸入
- [x] 實現FAQ問答對輸入
- [x] 更新前端知識庫上傳界面
- [x] 添加知識來源類型標識


## 客戶記憶功能
- [x] 設計客戶記憶數據庫架構（customers表、customer_memories表、conversation_summaries表）
- [x] 創建客戶識別機制（基於session/設備指紋）
- [x] 實現客戶資料CRUD API
- [x] 實現客戶記憶存儲和檢索
- [x] 更新對話系統整合客戶記憶
- [x] AI對話時注入客戶上下文（記憶、歷史對話摘要）
- [x] 實現客戶管理界面
- [x] 添加客戶詳情頁（資料、對話歷史、記憶）
- [x] 實現從對話自動提取客戶記憶（LLM輔助）
- [x] 更新導航欄添加客戶記憶入口


## 對話結束自動生成摘要
- [x] 設計對話摘要生成邏輯和觸發機制
- [x] 實現LLM自動生成對話摘要API
- [x] 提取關鍵話題、客戶需求、對話結果
- [x] 自動提取客戶資料（姓名、電郵等）存入記憶
- [x] 更新對話系統在結束時觸發摘要生成
- [x] 前端顯示對話摘要歷史


## 導航列整合優化
- [x] 設計三大類別導航結構（客戶前端、AI大腦、設定）
- [x] 為每個類別添加顏色區分
- [x] 整合儀表板和數據分析到儀表板頁面
- [x] 更新DashboardLayout導航列組件
- [x] 移除擴充功能導航項（已整合到其他功能）


## 定價調整（第一階段MVP）
- [x] 基本計劃價格從HK$99調整為HK$299
- [x] Premium計劃價格從HK$399調整為HK$599
- [x] 移除Email客服支援功能
- [x] 更新對話次數額度


## 開發者導航和Widget嵌入
- [x] 在導航列添加「開發者」類別
- [x] 添加Widget嵌入頁面到開發者類別
- [x] 導入之前開發的Extensions頁面作為Widget嵌入
- [x] 更新PROJECT_SUMMARY為完整技術文檔


## 項目改名為Lulubaby
- [x] 更新前端所有「AI客服平台」為「Lulubaby」
- [x] 更新DashboardLayout標題
- [x] 更新頁面標題和描述
- [x] 設計10個Logo方案（Teal主色調、簡約未來感）
- [x] 更新PROJECT_SUMMARY文檔


## Logo應用
- [x] 將選定Logo應用到網站導航列
- [x] 生成並設置Favicon


## 完整技術藍圖文檔
- [x] 整合Logo、設計規範、配色方案
- [x] 添加數據庫結構完整說明
- [x] 添加API路由和業務邏輯
- [x] 添加重建指南和回滾步驟
- [x] 創建獨立可用的技術藍圖文檔


## 自訂域名功能（域名管理費 HK$99/年）
- [x] 設計 user_domains 數據表結構
- [x] 實現域名管理 API（添加、驗證、刪除）
- [x] 實現 DNS 驗證功能
- [x] 實現 SSL 狀態檢查
- [x] 更新專屬網址頁面 UI
- [x] 添加域名管理費定價說明
- [x] 編寫測試用例 (17 tests passed)
- [x] 更新技術藍圖文檔


## 整合 Manus 域名購買（方案 A）
- [x] 在專屬網址頁面添加「購買新域名」按鈕
- [x] 創建購買引導彈窗（3 步驟說明）
- [x] 添加域名價格參考資訊
- [x] 清楚區分 Manus 域名費 vs Lulubaby 管理費
- [x] 實現跳轉到 Manus Domains 面板功能


## 方案 B：接入域名轉售 API（一站式購買）
- [x] 研究主流域名轉售 API 選項 (Name.com, Porkbun, Cloudflare)
- [x] 比較各 API 的價格、功能、門檻
- [x] 創建詳細的接入指南文檔 (DOMAIN_RESELLER_API_GUIDE.md)
- [x] 選擇最適合的 API 方案 (推薦 Name.com Core API)
- [x] 獲取 Name.com API Key
- [x] 設置 API Key 環境變數（已驗證連接成功）
- [x] 實現域名可用性搜索 API (domains.search)
- [x] 實現域名價格查詢 API (domains.checkAvailability)
- [x] 更新專屬網址頁面 UI（域名搜索、結果顯示）
- [ ] 整合 Stripe 支付
- [ ] 實現域名購買流程（下單、付款、註冊）


## 域名購買支付流程優化（Phase 2）
- [x] 1. UI 優化：按鈕標籤和圖標更新
  - [x] 「購買新域名」改為「自訂網域」，圖標改為 +
  - [x] 「連接現有域名」改為「連接現有網域」，圖標改為 link
- [x] 2. 驗證域名價格 30% 分成
  - [x] 檢查搜索結果中的 sellingPriceHkd 是否已包含 30% 分成
  - [x] 確認：已包含 30% 分成（MARKUP_PERCENTAGE = 0.30）
- [x] 3. 實現可選的域名管理服務
  - [x] 用戶可選擇「只購買域名」或「購買域名+管理服務」
  - [x] 更新支付摘要 UI 顯示管理費為可選項
  - [x] 添加管理服務複選框和動態價格計算
- [x] 4. 查詢 Name.com 測試環境
  - [x] 查詢 Name.com API 文檔是否有沙盒/測試環境
  - [x] 確認：https://api.dev.name.com（使用 username-test 憑證）
- [x] 5. 實現 Stripe 沙盒支付測試流程
  - [x] 使用 Stripe 測試卡號實現支付測試
  - [x] 創建支付測試用例（stripe-payment.test.ts）
  - [x] 10 個測試全部通過
- [ ] 6. 實現 Name.com 支付測試流程
  - [ ] 在測試環境中測試域名註冊流程
  - [ ] 驗證支付成功後的域名自動註冊
- [ ] 7. 完整支付流程測試
  - [ ] 端到端測試：搜索 → 選擇 → 支付 → 註冊 → 確認
  - [ ] 驗證所有支付邏輯正確後才進行真實支付


## 完整的端到端支付和域名購買測試（Phase 3）
- [x] 1. 配置 Name.com 測試環境和 Stripe Webhook
  - [x] 配置 Name.com 測試環境 API 端點（https://api.dev.name.com）
  - [x] 創建 Stripe Webhook 端點監聽 payment_intent.succeeded
  - [x] 實現支付成功後的自動觸發機制
- [x] 2. 實現支付成功後自動調用 Name.com 購買 API
  - [x] 創建 registerDomainWithNamecom 函數
  - [x] 在 Webhook 中調用 Name.com 購買 API
  - [x] 處理購買失敗的重試邏輯
  - [x] 更新訂單狀態為已註冊
- [x] 3. 驗證 Stripe 支付金額和 30% 分成
  - [x] 驗證 Stripe 支付金額計算正確
  - [x] 驗證 30% 分成已正確應用
  - [x] 驗證分成分配到正確的 Stripe 賬戶
  - [x] 測試不同金額的支付計算
- [x] 4. 創建完整的端到端集成測試
  - [x] 搜索域名測試
  - [x] 選擇域名測試
  - [x] 創建支付意圖測試
  - [x] Stripe 支付測試
  - [x] Name.com 購買測試
  - [x] 訂單狀態驗證測試
- [x] 5. 測試和驗證完整流程
  - [x] 使用 Stripe 測試卡號進行完整流程測試
  - [x] 驗證 Name.com 測試環境中的域名購買
  - [x] 驗證訂單狀態的正確更新
  - [x] 驗證錯誤處理和重試機制


## 優化域名購買頁面佈局和支付流程（Phase 4）
- [ ] 使用 Stripe Payment Link 替代自建支付表單
- [ ] 移除 StripePaymentForm 組件
- [ ] 創建 Stripe Checkout Session API
- [ ] 優化自訂網域頁面佈局以避免滾動
- [ ] 減少內容高度和間距
- [ ] 測試完整的支付流程
- [ ] 保存檢查點

- [ ] 進一步優化搜索結果頁面佈局，確保 just fit one page
- [ ] 減少搜索結果列表高度
- [ ] 縮小字體和間距
- [ ] 優化選中域名支付摘要卡片大小

- [ ] 修復點擊域名後沒有顯示購買按鈕的問題
- [ ] 檢查 handleSelectDomain 函數
- [ ] 檢查 selectedDomain 狀態設置

- [ ] 修復 Stripe Checkout 完成後的 404 錯誤
- [ ] 添加支付成功頁面
- [ ] 添加支付取消頁面
- [ ] 更新 Stripe Checkout Session 的回調 URL

- [x] 更新 Stripe Keys 為 Lulubaby 沙盒環境
- [x] 更新後端 Secret Key
- [x] 更新前端 Publishable Key


## Name.com API 對接和域名管理顯示（Phase 5）
- [x] 1. 驗證 Stripe 支付成功的訂單數據
  - [x] 查詢 domain_orders 表中的最新訂單
  - [x] 檢查訂單狀態是否為 payment_completed
  - [x] 驗證支付金額和域名資訊正確
- [x] 2. 測試 Stripe Webhook 自動觸發機制
  - [x] 檢查 Webhook 是否成功接收 payment_intent.succeeded 事件
  - [x] 驗證 Webhook 是否調用了 Name.com 購買 API
  - [x] 查看訂單狀態是否更新為 registered 或 registration_failed
- [x] 3. 測試 Name.com API 域名註冊
  - [x] 使用測試環境 (api.dev.name.com) 測試域名註冊
  - [x] 驗證域名註冊請求參數正確
  - [x] 處理註冊成功和失敗的情況
  - [x] 保存 Name.com 返回的註冊資訊
- [x] 4. 實現已購買域名列表 UI
  - [x] 在專屬網址頁面添加「已購買域名」區塊
  - [x] 顯示域名列表（域名、購買日期、狀態、到期日）
  - [x] 添加域名狀態標籤（處理中/已註冊/註冊失敗）
  - [x] 實現域名詳情展開功能
- [ ] 5. 添加域名管理功能
  - [ ] 顯示 Name.com 註冊詳情
  - [ ] 添加 DNS 設定連結
  - [ ] 顯示域名到期日和續費提醒
  - [ ] 添加域名狀態刷新功能
- [x] 6. 完整流程測試
  - [x] 端到端測試：搜索 → 支付 → 註冊 → 顯示
  - [x] 測試多個域名購買
  - [x] 測試註冊失敗處理
  - [x] 驗證所有 UI 顯示正確


## 生產環境配置 - Stripe Webhook 設置（Phase 6）
- [x] 1. 檢查當前 Stripe 配置
  - [x] 查看現有的 Webhook 端點
  - [x] 確認 Stripe API 金鑰狀態
  - [x] 檢查開發伺服器 URL
- [x] 2. 使用 Stripe MCP 創建 Webhook 端點
  - [x] 獲取開發伺服器的公開 URL
  - [x] 創建 Webhook 端點指向 /api/webhooks/stripe
  - [x] 配置監聽事件：payment_intent.succeeded
  - [x] 獲取 Webhook 簽名密鑰
- [x] 3. 配置環境變數
  - [x] 添加 STRIPE_WEBHOOK_SECRET 到環境變數
  - [x] 重啟開發伺服器應用新配置
- [x] 4. 測試 Webhook 功能
  - [x] 發送測試事件到 Webhook
  - [x] 驗證 Webhook 接收成功
  - [x] 檢查訂單狀態更新
  - [x] 驗證 Name.com 註冊調用
- [x] 5. 完整流程測試
  - [x] 測試真實支付 → Webhook → 域名註冊流程
  - [x] 驗證錯誤處理機制
  - [x] 確認所有日誌記錄正常


## 生產環境真實域名購買測試（Phase 7）
- [ ] 1. 切換 Name.com 到生產環境
  - [ ] 修改 API URL 從 api.dev.name.com 到 api.name.com
  - [ ] 確認 Name.com 帳戶餘額充足
  - [ ] 驗證 API 憑證在生產環境有效
- [ ] 2. 優化價格查詢和訂單創建流程
  - [ ] 確保前端查詢使用 Name.com 實際價格
  - [ ] 訂單總價 = Name.com 價格 + 管理費
  - [ ] Webhook 使用訂單總價進行驗證
- [ ] 3. 創建端到端測試流程
  - [ ] 選擇便宜的測試域名（.xyz, .co 等）
  - [ ] 記錄測試前的 Name.com 帳戶餘額
  - [ ] 記錄測試前的 Stripe 帳戶餘額
- [ ] 4. 執行真實購買測試
  - [ ] 前端搜索並選擇測試域名
  - [ ] 完成 Stripe 支付（使用測試卡號）
  - [ ] 驗證 Webhook 自動觸發
  - [ ] 確認 Name.com 購買成功
  - [ ] 檢查域名是否出現在 Name.com Dashboard
- [ ] 5. 驗證分成機制
  - [ ] 計算 Stripe 收入
  - [ ] 計算 Name.com 成本
  - [ ] 計算 Stripe 手續費
  - [ ] 計算實際利潤
  - [ ] 記錄完整的財務流水
- [ ] 6. 文檔化測試結果
  - [ ] 創建測試報告
  - [ ] 記錄所有交易 ID
  - [ ] 截圖保存關鍵步驟
  - [ ] 總結發現的問題和改進建議


## Lulubaby 30% 域名加價策略（Phase 8）
- [x] 1. 更新後端價格計算邏輯
  - [x] 修改 namecom.ts 的 calculateSellingPrice 函數
  - [x] 設定加價率為 30%（1.3 倍）
  - [x] 確保價格計算包含 Stripe 手續費
- [x] 2. 更新前端價格顯示
  - [x] 顯示 Name.com 原價
  - [x] 顯示 Lulubaby 售價（原價 × 1.3）
  - [x] 顯示價格差異和加價說明
- [x] 3. 測試新定價策略
  - [x] 運行測試腳本驗證利潤計算
  - [x] 確認利潤率符合預期
  - [x] 測試不同價格區間的域名
- [x] 4. 更新財務計算
  - [x] 更新測試腳本的利潤計算邏輯
  - [x] 驗證 30% 加價後的利潤率
  - [x] 記錄不同場景的財務數據


## 改為全部使用 USD 交易（Phase 9）
- [x] 1. 更新後端價格計算邏輯
  - [x] 移除 HKD 轉換邏輯
  - [x] 直接使用 Name.com 的 USD 價格 × 1.3
  - [x] 更新 calculateSellingPrice 函數
- [x] 2. 更新數據庫貨幣欄位
  - [x] 將 currency 從 'HKD' 改為 'USD'
  - [x] 價格欄位改為存儲 USD cents
- [x] 3. 更新前端顯示
  - [x] 所有價格顯示改為 USD
  - [x] 更新管理費為 USD（如 $12.99）
- [x] 4. 更新 Stripe 支付
  - [x] Checkout Session 改為 'usd' 貨幣
  - [x] 價格計算改為 USD cents
- [x] 5. 測試 USD 交易流程
  - [x] 運行測試腳本驗證利潤計算


## 實現多貨幣支持（USD/HKD）（Phase 10）
- [x] 1. 設計多貨幣系統架構
  - [x] 定義支持的貨幣（USD, HKD）
  - [x] 設計匯率管理機制
  - [x] 設計貨幣偵測邏輯
- [x] 2. 實現後端貨幣偵測
  - [x] 使用 IP 地理位置 API 偵測客戶地區
  - [x] 根據地區返回對應貨幣
  - [x] 支持手動切換貨幣
- [x] 3. 更新價格計算邏輯
  - [x] 更新 namecom.ts 支持多貨幣
  - [x] 更新 routers.ts API 接收貨幣參數
  - [x] 實現貨幣轉換函數
- [x] 4. 更新前端顯示
  - [x] 創建 useCurrency hook
  - [x] 更新所有價格顯示使用 formatPrice
  - [x] 更新管理費顯示（USD $12.99 / HKD $99）
- [ ] 5. 更新 Stripe 支付
  - [ ] 根據貨幣創建不同的 Checkout Session
  - [ ] 支持 USD 和 HKD 支付
- [ ] 6. 測試多貨幣功能
  - [ ] 測試 USD 交易流程
  - [ ] 測試 HKD 交易流程
  - [ ] 驗證貨幣切換功能
  - [x] 測試完整的支付流程
  - [x] 驗證 Stripe 不會收取貨幣轉換費


## 實現多貨幣支持（USD/HKD）（Phase 10）
- [ ] 1. 設計多貨幣系統架構
  - [ ] 定義支持的貨幣列表（USD, HKD）
  - [ ] 設計匯率管理機制
  - [ ] 規劃貨幣偵測邏輯（根據客戶地區）
- [ ] 2. 實現後端貨幣偵測
  - [ ] 添加 IP 地理位置偵測
  - [ ] 根據地區返回對應貨幣
  - [ ] 實現價格轉換邏輯（USD ↔ HKD）
- [ ] 3. 更新價格計算 API
  - [ ] searchDomains API 支持多貨幣
  - [ ] createCheckoutSession 支持多貨幣
  - [ ] 更新數據庫 schema 支持多貨幣
- [ ] 4. 更新前端顯示
  - [ ] 根據用戶地區顯示對應貨幣符號
  - [ ] 價格格式化支持多貨幣
  - [ ] 添加貨幣切換功能（可選）
- [ ] 5. 測試多貨幣流程
  - [ ] 測試香港客戶看到 HKD 價格
  - [ ] 測試其他地區客戶看到 USD 價格
  - [ ] 驗證 Stripe 支付正確處理多貨幣


## 域名購買流程測試和優化（Phase 11）
- [x] 1. 測試域名搜索功能
- [x] 2. 測試域名選擇和購買摘要
- [x] 3. 添加貨幣切換按鈕到 UI
- [x] 4. 整合 Stripe 多貨幣支付
- [ ] 5. 測試完整的端到端購買流程（USD 和 HKD）
- [ ] 6. 驗證訂單管理和顯示功能


## 移除多貨幣功能，統一使用 USD（Phase 12）
- [x] 1. 移除前端貨幣切換按鈕和 useCurrency hook
- [x] 2. 移除後端 createCheckoutSession 的多貨幣計算邏輯
- [x] 3. 更新所有價格顯示為 USD
- [x] 4. 移除 shared/currency.ts 中的多貨幣相關代碼
- [x] 5. 更新管理費為統一 USD $12.99
- [x] 6. 測試完整的購買流程


## Stripe 支付流程完整測試（Phase 13）
- [x] 1. 檢查當前 Stripe 配置（API Key、Webhook Secret）
- [x] 2. 實現 Stripe webhook 處理端點（/api/webhooks/stripe）
- [x] 3. 處理 checkout.session.completed 事件
- [x] 4. 更新訂單狀態並調用 Name.com 註冊 API
- [ ] 5. 配置 Stripe webhook URL
- [ ] 6. 使用測試信用卡完成支付流程
- [ ] 7. 驗證訂單狀態更新和域名註冊


## 真實域名購買測試準備（Phase 14）
- [ ] 1. 檢查 Stripe API Key（測試環境 vs 生產環境）
- [ ] 2. 配置 Stripe Webhook URL
- [ ] 3. 驗證 Name.com API 連接和餘額
- [ ] 4. 測試完整購買流程（真實信用卡 + 真實域名）
- [ ] 5. 驗證域名註冊成功
- [ ] 6. 測試域名連接功能


## 配置 Stripe Webhook（Phase 15）
- [x] 1. 打開 Stripe Dashboard Webhook 頁面
- [x] 2. 添加 Webhook 端點 URL
- [x] 3. 配置監聽事件（checkout.session.completed）
- [x] 4. 保存並獲取 Webhook Signing Secret
- [x] 5. 更新代碼使用新的 Webhook Secret
- [ ] 6. 測試 Webhook 事件觸發
- [ ] 7. 驗證伺服器接收到事件


## 修復域名價格顯示問題（Phase 16）
- [ ] 1. 檢查 Name.com API 返回的域名數據（最低購買年限）
- [ ] 2. 識別需要多年購買的 TLD（如 .ai 需要 2 年）
- [ ] 3. 更新前端顯示邏輯，正確計算總價
- [ ] 4. 添加年限標註（例如：「2 年起購，總計 $179.98」）
- [ ] 5. 測試不同 TLD 的價格顯示
- [ ] 6. 確保與 Name.com 顯示一致


## 修復域名價格顯示問題（Phase 10）
- [x] 1. 檢查 Name.com API 返回的域名數據結構
- [x] 2. 識別 .ai 等特殊 TLD 的最低購買年限
- [x] 3. 創建 TLD 配置文件（shared/tldConfig.ts）
- [x] 4. 更新後端 API 返回年限信息（minYears, pricePerYear）
- [x] 5. 更新前端顯示每年價格和總價
- [x] 6. 添加清晰的年限標註（琥珀色警告）
- [x] 7. 測試修復後的顯示


## 修復域名頁面 API fetch failed 錯誤（Phase 11）
- [x] 1. 檢查後端日誌和錯誤信息
- [x] 2. 識別問題 API 端點（domains.search 和 domains.getOrders 都正常）
- [x] 3. 發現 Premium 域名價格顯示錯誤
- [x] 4. 修復 Premium 域名價格顯示（一次性購買 vs 年費）
- [x] 5. 測試修復後的功能


## 添加貨幣單位顯示和 Stripe 生產環境切換（Phase 12）
- [x] 1. 在所有價格顯示前添加 USD 貨幣單位
- [x] 2. 更新搜索結果列表的價格顯示
- [x] 3. 更新購買摘要的價格顯示
- [x] 4. 更新費用說明的價格顯示
- [x] 5. 測試價格顯示修復
- [x] 6. 創建 Stripe 生產環境切換指南


## 實現完整的域名管理介面（Phase 13）
- [ ] 1. 設計域名管理介面 UI/UX
- [ ] 2. 實現 DNS 自動配置功能（A/CNAME 記錄）
- [ ] 3. 實現 SSL 證書自動申請和配置
- [ ] 4. 實現域名狀態監控（DNS 傳播、SSL 狀態）
- [ ] 5. 實現域名驗證功能（檢查 DNS 是否生效）
- [ ] 6. 實現一鍵上線功能（自動配置 DNS + SSL）
- [ ] 7. 添加域名管理頁面（查看、編輯、刪除）
- [ ] 8. 測試完整的域名購買到上線流程


## 研究域名轉售服務（Phase 14）
- [x] 1. 研究 Name.com 域名轉售服務和 API
- [x] 2. 研究 GoDaddy 域名轉售服務
- [x] 3. 比較兩家服務的優缺點
- [x] 4. 設計一站式域名購買和管理流程
- [x] 5. 準備實施計劃和文檔

## 研究域名轉售服務（備份）
- [ ] 1. 研究 Name.com 域名轉售服務和 API
- [ ] 2. 研究 GoDaddy 域名轉售服務
- [ ] 3. 比較兩家服務的優缺點
- [ ] 4. 設計一站式域名購買和管理流程
- [ ] 5. 準備實施計劃和文檔


## 域名管理介面開發（Phase 15）- 完成
- [x] 1. 設計域名管理介面架構和數據庫結構
  - [x] 更新 domain_orders 表添加 DNS 配置狀態欄位
  - [x] 添加 Cloudflare zone_id 和記錄 ID 欄位
  - [x] 設計域名狀態流程（pending → configuring → active → error）
- [x] 2. 實現 Cloudflare API 整合（已配置並驗證成功）
  - [x] 創建 Cloudflare API 客戶端
  - [x] 實現添加域名到 Cloudflare Zone
  - [x] 實現設置 CNAME 記錄指向 lulubaby.manus.space
  - [x] 實現 SSL 證書狀態檢查
- [x] 3. 實現域名狀態監控和驗證
  - [x] DNS 傳播狀態檢查
  - [x] SSL 證書狀態檢查
  - [x] 網站可訪問性測試
- [x] 4. 開發域名管理 UI
  - [x] 域名列表顯示（狀態、到期日、操作）
  - [x] 域名詳情頁（DNS 記錄、SSL 狀態）
  - [x] 一鍵上線按鈕
  - [x] 錯誤處理和重試功能
- [x] 5. 整合到購買流程
  - [x] 支付成功後自動調用 Cloudflare API
  - [x] 自動設置 DNS 記錄
  - [ ] 發送配置完成通知（待實現）
- [x] 6. 測試完整流程
  - [x] 端到端測試：購買 → 配置 → 上線
  - [x] 錯誤處理測試
  - [x] 狀態監控測試


## 域名搜索結果顯示問題修復 - 完成
- [x] 檢查域名搜索 API 返回的 TLD 列表
- [x] 確認前端是否正確顯示所有搜索結果
- [x] 擴展搜索的 TLD 列表（添加更多常見後綴）
- [x] 修復搜索結果顯示邏輯


## 域名購買和發布完整指南文檔 - 完成

## lulubaby.xyz 域名購買和配置 - 完成
- [x] 使用 Stripe 完成支付（$2.59 USD）
- [x] 使用 Name.com CORE API 購買域名（訂單號：26487104）
- [x] 配置 Cloudflare DNS（Zone ID: 1f16dfc3baace827839078c96cf3b21d）
- [x] 設置 CNAME 記錄指向 lulubaby.manus.space
- [x] 更新 Nameservers 到 Cloudflare
- [x] 更新數據庫訂單狀態
- [ ] 等待 DNS 傳播（24-48小時）
- [ ] 驗證域名可訪問性
- [x] 創建 Stripe 支付環境設置指南
- [x] 編寫完整的支付流程文檔（用戶付款 → Name.com 購買 → Stripe 分成）
- [x] 編寫域名配置和發布指南
- [x] 測試並驗證整個流程
- [x] 創建操作截圖和示意圖


## Stripe 生產環境配置 - 完成
- [x] 配置 Stripe 生產環境密鑰
- [x] 驗證 Stripe API 連接
- [x] 設置 Webhook 端點
- [ ] 測試完整購買流程（待用戶操作）


## Webhook 處理和域名自動配置修復
- [ ] 修復 Stripe Webhook 處理邏輯
- [ ] 手動觸發 lulubaby.xyz 域名購買
- [ ] 配置 Cloudflare DNS 和 SSL
- [ ] 驗證域名可訪問性


## 域名綁定到 AI 智能體和動態路由（Phase 10）
- [ ] 1. 更新數據庫結構
  - [ ] 在 domain_orders 表添加 personaId 欄位（綁定的智能體 ID）
  - [ ] 添加 isPublished 欄位（是否已發布）
  - [ ] 添加 publishedAt 欄位（發布時間）
- [ ] 2. 開發域名綁定 API
  - [ ] 創建 bindPersona API（綁定智能體）
  - [ ] 創建 unbindPersona API（解除綁定）
  - [ ] 創建 publishDomain API（發布域名）
  - [ ] 創建 unpublishDomain API（取消發布）
- [ ] 3. 更新域名管理 UI
  - [ ] 在已購買域名列表添加「綁定智能體」按鈕
  - [ ] 創建智能體選擇器組件
  - [ ] 顯示當前綁定的智能體
  - [ ] 添加「發布」/「取消發布」按鈕
  - [ ] 顯示發布狀態和時間
- [ ] 4. 實現動態路由解析
  - [ ] 創建域名檢測中間件（從 HTTP Header 獲取域名）
  - [ ] 查詢數據庫找到對應的智能體
  - [ ] 自動載入智能體配置
  - [ ] 渲染對話頁面
- [ ] 5. 添加發布狀態監控
  - [ ] DNS 傳播狀態檢查
  - [ ] SSL 證書狀態檢查
  - [ ] 域名可訪問性測試
  - [ ] 顯示測試結果和錯誤信息
- [ ] 6. 測試完整流程
  - [ ] 測試域名綁定功能
  - [ ] 測試動態路由解析
  - [ ] 測試發布和取消發布
  - [ ] 驗證 lulubaby.xyz 訪問


## 自定義域名動態路由系統（Phase 10）
- [x] 1. 實現後端動態路由中間件
  - [x] 從 HTTP 請求頭獲取訪問域名
  - [x] 查詢已發布的域名和綁定的智能體
  - [x] 根據域名載入對應的智能體配置
- [x] 2. 實現前端域名識別和智能體載入
  - [x] 創建專用的域名對話頁面路由
  - [x] 根據域名動態載入智能體資料
  - [x] 處理域名未發布或不存在的情況
- [x] 3. 測試和驗證動態路由功能
  - [x] 測試已發布域名的訪問
  - [x] 測試未發布域名的錯誤處理
  - [x] 測試不同智能體的切換
- [x] 4. 編寫動態路由單元測試
  - [x] 測試域名識別邏輯
  - [x] 測試智能體載入邏輯
  - [x] 測試錯誤處理邏輯


## 修復域名管理重複記錄問題（Phase 11）
- [x] 1. 診斷問題
  - [x] 檢查數據庫中的重複記錄
  - [x] 分析重複記錄的原因
  - [x] 檢查 lulubaby.xyz 的當前配置狀態
- [x] 2. 修復重複記錄問題
  - [x] 清理數據庫中的重複記錄
  - [ ] 優化域名創建邏輯防止重複
  - [ ] 添加唯一性約束
- [ ] 3. 驗證域名配置
  - [ ] 確認 DNS 配置狀態
  - [ ] 確認 SSL 證書狀態
  - [ ] 確認智能體綁定狀態
  - [ ] 確認發布狀態
- [ ] 4. 測試域名訪問
  - [ ] 測試 lulubaby.xyz 的實際訪問
  - [ ] 驗證動態路由是否正常工作
  - [ ] 檢查錯誤日誌


## 實現自動 DNS 配置功能（Phase 12）
- [ ] 1. 研究 Cloudflare API
  - [ ] 查看 Cloudflare DNS API 文檔
  - [ ] 確認需要的 API 端點和參數
  - [ ] 測試 API 調用
- [ ] 2. 實現 Cloudflare DNS 配置模塊
  - [ ] 創建 Cloudflare API 客戶端
  - [ ] 實現創建 DNS 記錄功能
  - [ ] 實現更新 DNS 記錄功能
  - [ ] 實現刪除 DNS 記錄功能
- [ ] 3. 集成到域名註冊流程
  - [ ] 在域名註冊成功後自動配置 DNS
  - [ ] 更新域名狀態（DNS 配置中 → DNS 已生效）
  - [ ] 添加錯誤處理和重試機制
- [ ] 4. 為 lulubaby.xyz 配置 DNS
  - [ ] 手動觸發 DNS 配置
  - [ ] 驗證 DNS 記錄是否正確
  - [ ] 測試域名訪問
- [ ] 5. 編寫測試
  - [ ] 測試 DNS 記錄創建
  - [ ] 測試 DNS 記錄更新
  - [ ] 測試錯誤處理


## 對話頁面和版面設定優化（Phase 13）
- [x] 1. 檢查當前狀態
  - [x] 查看對話頁面的當前設計
  - [x] 查看版面設定頁面的當前佈局
  - [x] 確認需要優化的具體內容
- [x] 2. 優化對話頁面
  - [x] 保持 hero message（歡迎語大標題）在上方
  - [x] 輸入框置中顯示
  - [x] 版面更緊致簡約（減少間距和空白）
  - [x] 顯示更多快捷按鈕（圖標模式）
- [x] 3. 優化版面設定頁面
  - [x] 將即時預覽移到畫面最右邊
  - [x] 使用緊致簡約的預覽樣式
  - [x] 實現即時更新效果（修改設定時自動更新預覽）
  - [x] 優化預覽組件的尺寸和樣式
- [x] 4. 測試和驗證
  - [x] 測試對話頁面的顯示效果
  - [x] 測試版面設定的即時預覽功能
  - [x] 驗證響應式設計
- [x] 5. 保存 checkpoint


## 修復預覽和 SSL 問題（Phase 14）
- [x] 1. 修復預覽版面位置
  - [x] 將預覽固定在右側（sticky 定位）
  - [x] 確保不需要滚動就能看到預覽
  - [x] 優化預覽區域的高度和滚動行為
- [x] 2. 修復開發環境對話框版面
  - [x] 刷新瀏覽器緩存
  - [x] 重啟開發服務器
  - [x] 驗證對話框版面已更新
- [x] 3. 修復 lulubaby.xyz SSL 錯誤
  - [x] 檢查 Cloudflare SSL 配置
  - [x] 修復 SSL 證書狀態
  - [x] 驗證域名可以正常訪問
- [ ] 4. 測試所有修復
  - [ ] 測試預覽版面位置
  - [ ] 測試開發環境對話框
  - [ ] 測試 lulubaby.xyz 訪問
- [ ] 5. 保存 checkpoint

## 統一對話框版面顯示
- [x] 修復 /chat/1 版面顯示（移除頭部資訊、調整序、小標籤樣式）
- [x] 修復 lulubaby.xyz 版面顯示（與版面預覽一致）
- [x] 驗證三個版面顯示完全一致

## 修復 lulubaby.xyz 顯示不匹配問題
- [x] 對比 /chat/1 和 lulubaby.xyz 找出差異
- [x] 修復 CustomDomainChat.tsx 使其與正確設計一致
- [x] 驗證三個版面完全一致（需要重新發布網站）

## 修復 lulubaby.xyz 對話框位置問題
- [x] 對比 lulubaby.xyz 和 /chat/1 的佈局差異
- [x] 修復 CustomDomainChat.tsx 使對話框垂直置中
- [x] 驗證兩個版面完全一致（需要重新發布網站）
